-- DỊCH VỤ VÀ BIẾN CỤC BỘ
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local Player = Players.LocalPlayer or Players.PlayerAdded:Wait()

-- XÓA GUI CŨ NẾU CÓ (Tránh bị chồng lấn nhiều menu)
if game.CoreGui:FindFirstChild("FixedTopBarMenu") then
    game.CoreGui.FixedTopBarMenu:Destroy()
end
if Player:WaitForChild("PlayerGui"):FindFirstChild("FixedTopBarMenu") then
    Player.PlayerGui.FixedTopBarMenu:Destroy()
end

-- TẠO GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FixedTopBarMenu"
ScreenGui.ResetOnSpawn = false -- QUAN TRỌNG: Giữ GUI không bị mất khi chết

-- THỬ ĐƯA VÀO COREGUI (Ưu tiên), NẾU KHÔNG ĐƯỢC THÌ ĐƯA VÀO PLAYERGUI
local success, _ = pcall(function()
    ScreenGui.Parent = game.CoreGui
end)
if not success then
    ScreenGui.Parent = Player:WaitForChild("PlayerGui")
end

-- CÁC PHẦN TỬ GIAO DIỆN
local MainFrame = Instance.new("Frame")
local HomeBar = Instance.new("TextButton") 
local SpeedInput = Instance.new("TextBox")
local JumpInput = Instance.new("TextBox")
local ApplyBtn = Instance.new("TextButton")

-- 1. THANH NGANG (HOME BAR)
HomeBar.Name = "HomeBar"
HomeBar.Parent = ScreenGui
HomeBar.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
HomeBar.BackgroundTransparency = 0.2
HomeBar.BorderSizePixel = 0
HomeBar.Position = UDim2.new(0, 10, 0, 0) -- Sát mép trên
HomeBar.Size = UDim2.new(0, 80, 0, 6) -- Dày hơn chút cho dễ bấm
HomeBar.Text = ""
HomeBar.AutoButtonColor = false

local BarCorner = Instance.new("UICorner", HomeBar)
BarCorner.CornerRadius = UDim.new(1, 0)

-- 2. GIAO DIỆN CHÍNH (MAIN FRAME)
MainFrame.Name = "MainFrame"
MainFrame.Parent = HomeBar 
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.Position = UDim2.new(0, 0, 0, 20) 
MainFrame.Size = UDim2.new(0, 140, 0, 150)
MainFrame.Visible = false 
MainFrame.BorderSizePixel = 0

local MainCorner = Instance.new("UICorner", MainFrame)
MainCorner.CornerRadius = UDim.new(0, 8)

-- LABEL TIÊU ĐỀ
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, 0, 0, 20)
Title.BackgroundTransparency = 1
Title.Text = "Bear Hub"
Title.TextColor3 = Color3.fromRGB(200, 200, 200)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 12

-- Input Tốc độ
SpeedInput.Parent = MainFrame
SpeedInput.PlaceholderText = "Speed (16)"
SpeedInput.Size = UDim2.new(0.85, 0, 0, 30)
SpeedInput.Position = UDim2.new(0.075, 0, 0.2, 0)
SpeedInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
SpeedInput.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedInput.Text = "100" -- Giá trị gợi ý sẵn
Instance.new("UICorner", SpeedInput)

-- Input Nhảy
JumpInput.Parent = MainFrame
JumpInput.PlaceholderText = "Jump (50)"
JumpInput.Size = UDim2.new(0.85, 0, 0, 30)
JumpInput.Position = UDim2.new(0.075, 0, 0.45, 0)
JumpInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
JumpInput.TextColor3 = Color3.fromRGB(255, 255, 255)
JumpInput.Text = "100" -- Giá trị gợi ý sẵn
Instance.new("UICorner", JumpInput)

-- Nút Bật/Tắt
ApplyBtn.Parent = MainFrame
ApplyBtn.Text = "APPLY"
ApplyBtn.Size = UDim2.new(0.85, 0, 0, 35)
ApplyBtn.Position = UDim2.new(0.075, 0, 0.72, 0)
ApplyBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ApplyBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
ApplyBtn.Font = Enum.Font.GothamBold
Instance.new("UICorner", ApplyBtn)

----------------------------------------------------------------
-- LOGIC XỬ LÝ (QUAN TRỌNG)
----------------------------------------------------------------
local active = false

-- Hàm cập nhật chỉ số an toàn
local function setStats(char)
    if not char then return end
    local hum = char:WaitForChild("Humanoid", 5)
    if hum and active then
        -- Dùng pcall để tránh lỗi script nếu Humanoid bị khóa
        pcall(function()
            hum.WalkSpeed = tonumber(SpeedInput.Text) or 16
            hum.JumpPower = tonumber(JumpInput.Text) or 50
        end)
    end
end

-- 1. Bấm thanh ngang
HomeBar.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

-- 2. Tự động áp dụng lại khi hồi sinh
Player.CharacterAdded:Connect(function(newChar)
    task.wait(1) -- Đợi 1 giây cho game load xong nhân vật
    if active then
        setStats(newChar)
    end
end)

-- 3. Nút Apply
ApplyBtn.MouseButton1Click:Connect(function()
    active = not active
    local char = Player.Character
    
    if active then
        ApplyBtn.Text = "RESET"
        ApplyBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80) -- Đỏ nhạt
        ApplyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        setStats(char)
    else
        ApplyBtn.Text = "APPLY"
        ApplyBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        ApplyBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
        
        -- Reset về mặc định
        if char and char:FindFirstChild("Humanoid") then
            char.Humanoid.WalkSpeed = 16
            char.Humanoid.JumpPower = 50
        end
    end
end)

-- Thông báo đã load xong (Bấm F9 để xem nếu script chạy)
print("Script Menu Speed đã tải thành công!")
