local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- --- 1. CẤU HÌNH & TIỆN ÍCH ---
local UI_THEME = {
    Main = Color3.fromRGB(35, 35, 35),
    Secondary = Color3.fromRGB(50, 50, 50),
    Accent = Color3.fromRGB(0, 170, 255),
    Text = Color3.fromRGB(255, 255, 255),
    On = Color3.fromRGB(0, 200, 100),
    Off = Color3.fromRGB(200, 50, 50)
}

-- Hàm tạo Object nhanh (Giúp code gọn hơn 50%)
local function Create(class, props)
    local obj = Instance.new(class)
    for k, v in pairs(props) do
        obj[k] = v
    end
    if props.Parent == nil and class ~= "ScreenGui" then
        -- Tự động bo góc nếu cần (tuỳ chọn)
    end
    return obj
end

local function AddCorner(parent, radius)
    Create("UICorner", {CornerRadius = UDim.new(0, radius), Parent = parent})
end

-- --- 2. XỬ LÝ NHÂN VẬT (LOGIC) ---
local State = {
    Speed = { Enabled = false, Value = 16, Default = 16 },
    Jump = { Enabled = false, Value = 50, Default = 50 }
}

-- Hàm áp dụng chỉ số (Chỉ chạy khi cần thiết, không spam vòng lặp)
local function UpdateStats()
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChild("Humanoid")
    if not hum then return end

    -- Xử lý Speed
    hum.WalkSpeed = State.Speed.Enabled and State.Speed.Value or State.Speed.Default
    
    -- Xử lý Jump
    hum.UseJumpPower = true
    hum.JumpPower = State.Jump.Enabled and State.Jump.Value or State.Jump.Default
end

-- Tự động cập nhật khi hồi sinh
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(0.5) -- Đợi nhân vật load xong
    UpdateStats()
end)

-- --- 3. GIAO DIỆN (GUI) ---
local ScreenGui = Create("ScreenGui", {
    Name = "OptimizedHub",
    Parent = RunService:IsStudio() and LocalPlayer.PlayerGui or CoreGui
})

-- Nút mở menu nhỏ
local ToggleBtn = Create("TextButton", {
    Name = "Toggle", Parent = ScreenGui,
    Size = UDim2.new(0, 50, 0, 50), Position = UDim2.new(0.1, 0, 0.1, 0),
    BackgroundColor3 = UI_THEME.Accent, Text = "O",
    TextColor3 = UI_THEME.Text, Font = Enum.Font.FredokaOne, TextSize = 24
})
AddCorner(ToggleBtn, 12)

-- Khung chính
local MainFrame = Create("Frame", {
    Name = "Main", Parent = ScreenGui,
    Size = UDim2.new(0, 240, 0, 250), Position = UDim2.new(0.5, -120, 0.5, -125),
    BackgroundColor3 = UI_THEME.Main, Visible = false
})
AddCorner(MainFrame, 10)

Create("TextLabel", {
    Parent = MainFrame, Text = "CONTROL PANEL",
    Size = UDim2.new(1, 0, 0, 35), BackgroundTransparency = 1,
    TextColor3 = UI_THEME.Text, Font = Enum.Font.FredokaOne, TextSize = 20
})

-- Chức năng kéo thả (Draggable) mượt mà
local function MakeDraggable(frame)
    local dragging, dragInput, dragStart, startPos
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end
MakeDraggable(ToggleBtn)
MakeDraggable(MainFrame)

-- Logic ẩn hiện Menu
ToggleBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
    ToggleBtn.Text = MainFrame.Visible and "X" or "O"
    ToggleBtn.BackgroundColor3 = MainFrame.Visible and UI_THEME.Off or UI_THEME.Accent
end)

-- --- 4. HÀM TẠO THANH ĐIỀU KHIỂN ---
local function CreateSlider(text, yPos, typeStr, maxVal)
    local Holder = Create("Frame", {
        Parent = MainFrame, BackgroundColor3 = UI_THEME.Secondary,
        Size = UDim2.new(0.9, 0, 0, 75), Position = UDim2.new(0.05, 0, 0, yPos)
    })
    AddCorner(Holder, 8)

    -- Label
    Create("TextLabel", {
        Parent = Holder, Text = text,
        Size = UDim2.new(0.6, 0, 0, 30), Position = UDim2.new(0.05, 0, 0, 0),
        BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left,
        TextColor3 = UI_THEME.Text, Font = Enum.Font.SourceSansBold, TextSize = 16
    })

    -- Nút Bật/Tắt
    local Switch = Create("TextButton", {
        Parent = Holder, Text = "OFF",
        Size = UDim2.new(0, 50, 0, 25), Position = UDim2.new(1, -60, 0, 5),
        BackgroundColor3 = UI_THEME.Off, TextColor3 = UI_THEME.Text, Font = Enum.Font.SourceSansBold
    })
    AddCorner(Switch, 6)

    -- Slider Bar
    local SliderBg = Create("TextButton", {
        Parent = Holder, Text = "", AutoButtonColor = false,
        Size = UDim2.new(0.9, 0, 0, 8), Position = UDim2.new(0.05, 0, 0, 45),
        BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    })
    AddCorner(SliderBg, 4)

    local SliderFill = Create("Frame", {
        Parent = SliderBg, Size = UDim2.new(0, 0, 1, 0),
        BackgroundColor3 = UI_THEME.Accent, BorderSizePixel = 0
    })
    AddCorner(SliderFill, 4)

    local ValueLbl = Create("TextLabel", {
        Parent = Holder, Text = "Value: " .. State[typeStr].Default,
        Size = UDim2.new(1, 0, 0, 20), Position = UDim2.new(0, 0, 0, 55),
        BackgroundTransparency = 1, TextColor3 = Color3.fromRGB(180, 180, 180), TextSize = 12
    })

    -- Logic Switch
    Switch.MouseButton1Click:Connect(function()
        State[typeStr].Enabled = not State[typeStr].Enabled
        Switch.Text = State[typeStr].Enabled and "ON" or "OFF"
        Switch.BackgroundColor3 = State[typeStr].Enabled and UI_THEME.On or UI_THEME.Off
        UpdateStats() -- Cập nhật ngay lập tức
    end)

    -- Logic Slider
    local isDragging = false
    
    local function MoveSlider()
        local percent = math.clamp((Mouse.X - SliderBg.AbsolutePosition.X) / SliderBg.AbsoluteSize.X, 0, 1)
        local value = math.floor(percent * maxVal)
        
        SliderFill.Size = UDim2.new(percent, 0, 1, 0)
        State[typeStr].Value = value
        ValueLbl.Text = "Value: " .. value
        
        if State[typeStr].Enabled then
            UpdateStats() -- Chỉ cập nhật nhân vật nếu đang BẬT
        end
    end

    SliderBg.MouseButton1Down:Connect(function() isDragging = true; MoveSlider() end)
    UIS.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then isDragging = false end end)
    UIS.InputChanged:Connect(function(input) if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then MoveSlider() end end)
end

-- Tạo các bộ điều khiển
CreateSlider("Walk Speed", 50, "Speed", 300)
CreateSlider("Jump Power", 140, "Jump", 500)

print("Optimized UI Loaded Successfully!")
