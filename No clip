--[[
    Super Clean iOS Noclip UI
    Fix: Removed all containers and shadows to eliminate "faint squares"
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local noclipEnabled = false

--// 1. CLEANUP OLD UI //--
-- Tự động xóa UI cũ nếu bạn lỡ chạy script nhiều lần
for _, gui in pairs(CoreGui:GetChildren()) do
    if gui.Name == "GeminiCleanUI" then
        gui:Destroy()
    end
end

--// 2. UI CREATION //--
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "GeminiCleanUI"
if syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = CoreGui
elseif gethui then
    ScreenGui.Parent = gethui()
else
    ScreenGui.Parent = CoreGui
end

-- Nút Gạt (Chính là vật thể duy nhất, không có khung bao quanh)
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "Toggle"
ToggleButton.Text = "" -- Xóa chữ mặc định
ToggleButton.Size = UDim2.new(0, 70, 0, 36) -- Kích thước nút
ToggleButton.Position = UDim2.new(0.5, -35, 0, 10) -- Chính giữa màn hình, sát trên
ToggleButton.BackgroundColor3 = Color3.fromRGB(35, 35, 40) -- Màu nền xám
ToggleButton.BorderSizePixel = 0 -- Quan trọng: Xóa viền vuông mặc định
ToggleButton.AutoButtonColor = false -- Tắt hiệu ứng click mặc định
ToggleButton.Parent = ScreenGui

-- Bo tròn nút (Pill Shape)
local UICorner_Toggle = Instance.new("UICorner")
UICorner_Toggle.CornerRadius = UDim.new(1, 0)
UICorner_Toggle.Parent = ToggleButton

-- Viền cong mỏng (Stroke) - để nhìn rõ nút hơn
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(80, 80, 80)
UIStroke.Thickness = 1.5
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
UIStroke.Parent = ToggleButton

-- Cục tròn di chuyển (Knob)
local Knob = Instance.new("Frame")
Knob.Name = "Knob"
Knob.Size = UDim2.new(0, 30, 0, 30) -- Nhỏ hơn chiều cao nút một chút
Knob.Position = UDim2.new(0, 3, 0.5, -15) -- Canh giữa dọc
Knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Knob.BorderSizePixel = 0 -- Xóa viền vuông của cục tròn
Knob.Parent = ToggleButton

-- Bo tròn cục di chuyển thành hình tròn
local UICorner_Knob = Instance.new("UICorner")
UICorner_Knob.CornerRadius = UDim.new(1, 0)
UICorner_Knob.Parent = Knob

--// 3. LOGIC //--

-- Dragging Logic (Kéo thả trực tiếp trên nút)
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    ToggleButton.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

ToggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = ToggleButton.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

ToggleButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Noclip Loop
RunService.Stepped:Connect(function()
    if noclipEnabled and LocalPlayer.Character then
        for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide == true then
                part.CanCollide = false
            end
        end
    end
end)

-- Toggle Animation
local function toggleState()
    noclipEnabled = not noclipEnabled
    
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    
    if noclipEnabled then
        -- ON: Xanh lá
        TweenService:Create(ToggleButton, tweenInfo, {BackgroundColor3 = Color3.fromRGB(50, 205, 75)}):Play()
        TweenService:Create(Knob, tweenInfo, {Position = UDim2.new(1, -33, 0.5, -15)}):Play()
        TweenService:Create(UIStroke, tweenInfo, {Transparency = 1}):Play() -- Ẩn viền stroke
    else
        -- OFF: Xám
        TweenService:Create(ToggleButton, tweenInfo, {BackgroundColor3 = Color3.fromRGB(35, 35, 40)}):Play()
        TweenService:Create(Knob, tweenInfo, {Position = UDim2.new(0, 3, 0.5, -15)}):Play()
        TweenService:Create(UIStroke, tweenInfo, {Transparency = 0}):Play() -- Hiện viền stroke
    end
end

ToggleButton.MouseButton1Click:Connect(toggleState)

